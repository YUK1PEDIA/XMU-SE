[TOC]

# 讨论课二：界面设计与领域建模

需求

- 界面设计根据上次的用例进行设计，**需要提交界面设计的截图**（需要和用例是一致的）
- **根据之前的用例分析修改领域模型（通过小的修改实现新的需求）**
- 查看微信的 API 接口，能否实现多商户的商品一起下单合并支付再分到各个商户中
- **补充仲裁和评论两部分的领域建模**



## 产品子领域

- 组件图中蓝色部分为**服务售后仲裁**，绿色部分为**顾客**
  - 只需要在蓝色和绿色部分中选两个做



![1.png](https://s2.loli.net/2024/10/08/BFHGVKI29LUsYOj.png)

product 还对应一个草稿商品（draft-product），表示商户刚创建出来，还没有经过平台审核的商品

- draft-product 和 product 的关系为 0...1 的关系
- 一个 draft-product 可以被发布为正式商品
- product 和 category 为多对多的关系
- 一个商品可以关联多个商品（查看一个商品可以看到和他相关的其他商品）



**今年新增捆绑商品需求**，需要在领域模型新增对应内容

- 同样在 product 上更改，一个商品可以作为多个其他商品捆绑在一起的商品（一对多的关系）



其他补充：freight template（计算运费）、logistics（物流公司，一对多）、coupon activity（打折促销，多对多）、advance activity（预售）、group activity（团购）





## 商铺子领域

![1.png](https://s2.loli.net/2024/10/08/cpOjulIHdGhQfa8.png)

上图中 Shop 左侧缺少 user

- 一个商铺里有多个用户（user），不同用户有不同的角色。
- 运费模板和地区模板为一对多的关系

- 运费计算中，计算体积时采用运输物品的件数模板来计算





## 物流子领域

![1.png](https://s2.loli.net/2024/10/08/egPR3yVjm2ncYh5.png)

- 商户和物流公司通过**物流合同（月结）关联**。合同可以签多个，合同这边属于一对多中“多”的部分。
- 一个物流合同对应一个仓库和一个物流公司



改动时尽量不要改动现有的领域模型

**还需要描述服务商收发快递的过程**，服务商如寄修服务，同样也需要收发快递



## 支付子领域

![1.png](https://s2.loli.net/2024/10/09/C1XHnbucAlUJxS5.png)

- 对于退款交易和支付订单，两者是多对一的关系。一个订单可能包含多个商品，但退款退货可能只会退部分商品
- 平台分账与支付订单是一对一的关系，一个订单只会有一次平台分账
- 根据平台分账还衍生出平台退分帐（div_refund_trans）
- **ledger 记录对账**，当交易金额出现差错，会将当前情况记录在 ledger 中





## 订单子领域

![1.png](https://s2.loli.net/2024/10/09/a2YrHjAP4qmWBxe.png)

- 一个订单包含多个订单明细
- 一个订单只能参加一个活动
- 顾客不能直接看到支付和退款情况，只能通过订单来看到这两种情况





## 顾客子领域

![1.png](https://s2.loli.net/2024/10/09/Sf2j8cJPevayH4d.png)

- 此处的优惠券相当于优惠活动的门票，拥有优惠券才能参加优惠活动
- 顾客领取了优惠券后，优惠券才存在。
- 优惠券属于顾客，来自于一个商户和一个优惠活动